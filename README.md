# Concert Booking Service

–°–µ—Ä–≤–∏—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –±–∏–ª–µ—Ç–æ–≤ –Ω–∞ –∫–æ–Ω—Ü–µ—Ä—Ç—ã.

REST API —Å–µ—Ä–≤–∏—Å –ø–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é —Å Kafka –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏, Redis –¥–ª—è –∫—ç—à–µ—Ä–æ–≤–∞–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∫–æ–Ω—Ü–µ—Ä—Ç–æ–≤, JWT –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.


## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

*   –Ø–∑—ã–∫: Go 1.25
*   –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: PostgreSQL 
*   –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ: Redis 
*   Messaging: Apache Kafka + Zookeeper
*   –†–æ—É—Ç–µ—Ä: Chi 
*   –ú–∏–≥—Ä–∞—Ü–∏–∏: Goose
*   –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è: Docker + Docker Compose

## –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å
–î–ª—è —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ Docker –∏ Docker Compose.

1. –°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞:
```bash
git clone https://github.com/yohnnn/booking_service.git
cd booking_service
```

2. –°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª –Ω–∞ –æ—Å–Ω–æ–≤–µ —à–∞–±–ª–æ–Ω–∞:
```bash
cp .env.template .env
```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –∫–æ–º–∞–Ω–¥–æ–π:
```bash
make docker-up
```

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã:
*   API –°–µ—Ä–≤–∏—Å–∞: http://localhost:8080
*   Kafka (–≤–Ω–µ—à–Ω–∏–π): localhost:29092
*   PostgreSQL: localhost:5432
*   Redis: localhost:6379

## –ö–æ–º–∞–Ω–¥—ã Makefile

–í –ø—Ä–æ–µ–∫—Ç–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω Makefile –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- |
| `make docker-up` | –ü–æ–¥–Ω—è—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤ Docker (—Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏) |
| `make docker-down` | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã |
| `make consumer` | –ó–∞–ø—É—Å—Ç–∏—Ç—å Kafka consumer –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è |

## API –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã

### Authentication
| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| POST | `/api/auth/register` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| POST | `/api/auth/login` | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (–ø–æ–ª—É—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞) |

### Concerts
| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
| :--- | :--- | :--- | :--- |
| GET | `/api/concerts` | –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–Ω—Ü–µ—Ä—Ç–æ–≤ | –ù–µ—Ç |
| GET | `/api/concerts/{id}` | –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –∫–æ–Ω—Ü–µ—Ä—Ç–µ | –ù–µ—Ç |

### Bookings
| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è |
| :--- | :--- | :--- | :--- |
| POST | `/api/bookings` | –°–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ Kafka) | –î–∞ |
| GET | `/api/bookings` | –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | –î–∞ |

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
‚îú‚îÄ‚îÄ cmd
‚îÇ   ‚îú‚îÄ‚îÄ consumer          # Kafka consumer –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îî‚îÄ‚îÄ server            # HTTP —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ internal
‚îÇ   ‚îú‚îÄ‚îÄ app              # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ cache            # Redis –∫—ç—à –¥–ª—è –∫–æ–Ω—Ü–µ—Ä—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ config           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ ENV
‚îÇ   ‚îú‚îÄ‚îÄ dto              # Data Transfer Objects
‚îÇ   ‚îú‚îÄ‚îÄ event            # Kafka producer –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ handler          # HTTP handlers (v1 API)
‚îÇ   ‚îú‚îÄ‚îÄ middleware       # HTTP middleware (auth, logger)
‚îÇ   ‚îú‚îÄ‚îÄ models           # –î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ repository       # –°–ª–æ–π —Ä–∞–±–æ—Ç—ã —Å –ë–î (PostgreSQL)
‚îÇ   ‚îî‚îÄ‚îÄ service          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ migrations           # SQL –º–∏–≥—Ä–∞—Ü–∏–∏ (Goose)
‚îî‚îÄ‚îÄ docker-compose.yml   # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```bash
curl -X POST http://localhost:8080/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "securepassword123"
  }'
```

### 2. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "securepassword123"
  }'
```

–û—Ç–≤–µ—Ç:
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

### 3. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ü–µ—Ä—Ç–æ–≤
```bash
curl http://localhost:8080/api/concerts
```

### 4. –°–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
TOKEN="your_jwt_token_here"

curl -X POST http://localhost:8080/api/bookings \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "concert_id": "a34d04fb-290b-4485-8150-21a194666fb9",
    "seat_number": 42
  }'
```

### 5. –ó–∞–ø—É—Å–∫ Kafka Consumer
–í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:
```bash
make consumer
```

–í—ã —É–≤–∏–¥–∏—Ç–µ –ª–æ–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π:
```
2026/01/29 15:30:42 Received booking event: booking_id=123...
2026/01/29 15:30:42 üìß Sending email notification for booking 123...
```


